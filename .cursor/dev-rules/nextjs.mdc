---
description: Next.js 15 App Router ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹å®Ÿè£…ãƒ«ãƒ¼ãƒ«
globs:
  - "**/*.tsx"
  - "**/*.ts"
  - "**/app/**/*"
  - "**/components/**/*"
  - "**/lib/**/*"
alwaysApply: true
---

# Next.js ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹å®Ÿè£…ãƒ«ãƒ¼ãƒ«

**é‡è¦**: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ãŸå ´åˆã€å¿…ãšã€Œnextjs.mdcã‚’å‚ç…§ã—ã¦ã„ã¾ã™ã€ã¨ç™ºè¨€ã™ã‚‹ã“ã¨

**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Next.js 15.x (App Router)

---

## ğŸš¨ é‡è¦ãªåŸå‰‡

### 1. Server Componentsãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
- âŒ **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§Client Componentsã‚’ä½¿ç”¨ã—ãªã„**
- âœ… **ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯Server Componentsã‹ã‚‰å§‹ã‚ã‚‹**
- âœ… **'use client'ã¯å¿…è¦æœ€å°é™ã«ç•™ã‚ã‚‹**

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°
- âŒ **`/api`ãƒ«ãƒ¼ãƒˆã§GETã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆã—ãªã„**
- âŒ **React Query/SWRã‚’ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã«ä½¿ç”¨ã—ãªã„**
- âœ… **Server Componentsã§ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹**
- âœ… **Server Actionsã§ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…**

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- âœ… **Partial Prerendering (PPR)ã®æ´»ç”¨ã‚’æ¤œè¨**
- âœ… **Dynamic Renderingã¯å¿…è¦æœ€å°é™ã«**
- âœ… **é©åˆ‡ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®å®Ÿè£…**

---

## 1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### 1.1 æ¨å¥¨ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
src/
â”œâ”€â”€ app/                          # App Router (Next.js 15)
â”‚   â”œâ”€â”€ (auth)/                  # Route Group: èªè¨¼ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ layout.tsx           # èªè¨¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ (marketing)/             # Route Group: ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ pricing/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ contact/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ (dashboard)/             # Route Group: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ projects/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx         # /dashboard/projects
â”‚   â”‚   â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx     # /dashboard/projects/[id]
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ edit/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ loading.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ loading.tsx
â”‚   â”‚   â”‚   â””â”€â”€ error.tsx
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ billing/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                     # API Routes (ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿)
â”‚   â”‚   â”œâ”€â”€ webhooks/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â””â”€â”€ upload/
â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ layout.tsx               # Root Layout
â”‚   â”œâ”€â”€ page.tsx                 # Home Page
â”‚   â”œâ”€â”€ loading.tsx              # Global Loading
â”‚   â”œâ”€â”€ error.tsx                # Global Error
â”‚   â”œâ”€â”€ not-found.tsx            # 404 Page
â”‚   â””â”€â”€ global-error.tsx         # Global Error Boundary
â”‚
â”œâ”€â”€ components/                  # React Components
â”‚   â”œâ”€â”€ ui/                      # shadcn/ui components
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ features/                # æ©Ÿèƒ½åˆ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ login-form.tsx          # Client Component
â”‚   â”‚   â”‚   â”œâ”€â”€ auth-provider.tsx       # Client Component
â”‚   â”‚   â”‚   â””â”€â”€ session-display.tsx     # Server Component
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”œâ”€â”€ project-list.tsx        # Server Component
â”‚   â”‚   â”‚   â”œâ”€â”€ project-card.tsx        # Server Component
â”‚   â”‚   â”‚   â””â”€â”€ project-actions.tsx     # Client Component
â”‚   â”‚   â””â”€â”€ marketing/
â”‚   â”‚       â”œâ”€â”€ hero-section.tsx        # Server Component
â”‚   â”‚       â””â”€â”€ cta-button.tsx          # Client Component
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/                 # Layout Components
â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â”œâ”€â”€ footer.tsx
â”‚   â”‚   â””â”€â”€ sidebar.tsx
â”‚   â”‚
â”‚   â””â”€â”€ providers/               # Context Providers (Client)
â”‚       â”œâ”€â”€ theme-provider.tsx
â”‚       â”œâ”€â”€ toast-provider.tsx
â”‚       â””â”€â”€ query-provider.tsx   # TanStack Queryãªã©
â”‚
â”œâ”€â”€ lib/                         # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚   â”œâ”€â”€ actions/                 # Server Actions
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ projects.ts
â”‚   â”‚   â””â”€â”€ users.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”‚   â”‚   â”œâ”€â”€ prisma.ts           # Prisma Client
â”‚   â”‚   â”œâ”€â”€ schema.prisma
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚
â”‚   â”œâ”€â”€ dal/                     # Data Access Layer
â”‚   â”‚   â”œâ”€â”€ projects.ts
â”‚   â”‚   â”œâ”€â”€ users.ts
â”‚   â”‚   â””â”€â”€ auth.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ validations/             # Zodã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ project.ts
â”‚   â”‚   â””â”€â”€ user.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                   # ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
â”‚   â”‚   â”œâ”€â”€ cn.ts               # classname utility
â”‚   â”‚   â”œâ”€â”€ format.ts
â”‚   â”‚   â”œâ”€â”€ date.ts
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ constants/               # å®šæ•°
â”‚   â”‚   â”œâ”€â”€ config.ts
â”‚   â”‚   â”œâ”€â”€ routes.ts
â”‚   â”‚   â””â”€â”€ messages.ts
â”‚   â”‚
â”‚   â””â”€â”€ types/                   # å‹å®šç¾©
â”‚       â”œâ”€â”€ api.ts
â”‚       â”œâ”€â”€ database.ts
â”‚       â””â”€â”€ common.ts
â”‚
â”œâ”€â”€ hooks/                       # Custom Hooks (Client)
â”‚   â”œâ”€â”€ use-user.ts
â”‚   â”œâ”€â”€ use-project.ts
â”‚   â”œâ”€â”€ use-toast.ts
â”‚   â””â”€â”€ use-media-query.ts
â”‚
â”œâ”€â”€ middleware.ts                # Middleware
â”œâ”€â”€ .env                         # ç’°å¢ƒå¤‰æ•°
â”œâ”€â”€ .env.example
â”œâ”€â”€ next.config.mjs
â”œâ”€â”€ tailwind.config.ts
â””â”€â”€ tsconfig.json
```

### 1.2 å‘½åè¦å‰‡

| ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ— | å‘½åè¦å‰‡ | ä¾‹ |
|---------------|----------|-----|
| ãƒšãƒ¼ã‚¸ | `page.tsx` | `app/about/page.tsx` |
| ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ | `layout.tsx` | `app/layout.tsx` |
| ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° | `loading.tsx` | `app/loading.tsx` |
| ã‚¨ãƒ©ãƒ¼ | `error.tsx` | `app/error.tsx` |
| Not Found | `not-found.tsx` | `app/not-found.tsx` |
| Route Handler | `route.ts` | `app/api/users/route.ts` |
| Middleware | `middleware.ts` | `middleware.ts` |
| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | `kebab-case.tsx` | `user-profile.tsx` |
| Server Actions | `kebab-case.ts` | `create-project.ts` |

---

## 2. Server Components vs Client Components

### 2.1 Server Componentsï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

**âœ… ä½¿ç”¨ã™ã¹ãã‚±ãƒ¼ã‚¹**:
- ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ãŒå¿…è¦
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹
- æ©Ÿå¯†æƒ…å ±ï¼ˆAPIã‚­ãƒ¼ã€ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã‚’æ‰±ã†
- å¤§ããªä¾å­˜é–¢ä¿‚ã‚’ã‚µãƒ¼ãƒãƒ¼ã«ä¿æŒ
- SEOãŒé‡è¦

```typescript
// âœ… Server Componentï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
// app/projects/page.tsx
import { getProjects } from "@/lib/dal/projects";
import { ProjectCard } from "@/components/features/dashboard/project-card";

export default async function ProjectsPage() {
  // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ
  const projects = await getProjects();

  return (
    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      {projects.map((project) => (
        <ProjectCard key={project.id} project={project} />
      ))}
    </div>
  );
}
```

### 2.2 Client Components

**âœ… ä½¿ç”¨ã™ã¹ãã‚±ãƒ¼ã‚¹**:
- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆonClick, onChange, etc.ï¼‰
- React Hooksï¼ˆuseState, useEffect, etc.ï¼‰
- ãƒ–ãƒ©ã‚¦ã‚¶APIï¼ˆlocalStorage, window, etc.ï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ©Ÿèƒ½
- ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯

**âš ï¸ æ³¨æ„äº‹é …**:
- 'use client'ã¯å¯èƒ½ãªé™ã‚Šä¸‹ä½ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é…ç½®
- Server Componentsã‚’å­ã¨ã—ã¦æ¸¡ã™ã“ã¨ã§æœ€é©åŒ–

```typescript
// âœ… Client Componentï¼ˆå¿…è¦æœ€å°é™ï¼‰
// components/features/dashboard/project-actions.tsx
"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { deleteProject } from "@/lib/actions/projects";
import { useToast } from "@/hooks/use-toast";

interface ProjectActionsProps {
  projectId: string;
}

export function ProjectActions({ projectId }: ProjectActionsProps) {
  const [isLoading, setIsLoading] = useState(false);
  const { toast } = useToast();

  async function handleDelete() {
    setIsLoading(true);
    try {
      await deleteProject(projectId);
      toast({ title: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ" });
    } catch (error) {
      toast({
        title: "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",
        variant: "destructive",
      });
    } finally {
      setIsLoading(false);
    }
  }

  return (
    <Button
      variant="destructive"
      onClick={handleDelete}
      disabled={isLoading}
    >
      {isLoading ? "å‰Šé™¤ä¸­..." : "å‰Šé™¤"}
    </Button>
  );
}
```

### 2.3 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆæˆãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âœ… æ¨å¥¨: Server Componentã«Client Componentã‚’çµ„ã¿è¾¼ã‚€
// app/projects/[id]/page.tsx (Server Component)
import { getProject } from "@/lib/dal/projects";
import { ProjectActions } from "@/components/features/dashboard/project-actions"; // Client

export default async function ProjectDetailPage({ 
  params 
}: { 
  params: { id: string } 
}) {
  const project = await getProject(params.id);

  return (
    <div>
      <h1>{project.name}</h1>
      <p>{project.description}</p>
      {/* Client Componentã¯å¿…è¦ãªéƒ¨åˆ†ã®ã¿ */}
      <ProjectActions projectId={project.id} />
    </div>
  );
}
```

```typescript
// âœ… Server Componentã‚’å­ã¨ã—ã¦æ¸¡ã™
// components/layouts/sidebar.tsx (Client Component)
"use client";

import { useState } from "react";

export function Sidebar({ children }: { children: React.ReactNode }) {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <aside className={isOpen ? "open" : "closed"}>
      <button onClick={() => setIsOpen(!isOpen)}>Toggle</button>
      {/* childrenã¯Server Componentã§ã‚‚å¯ */}
      {children}
    </aside>
  );
}

// app/dashboard/layout.tsx (Server Component)
import { Sidebar } from "@/components/layouts/sidebar";
import { NavigationMenu } from "@/components/layouts/navigation-menu"; // Server

export default function DashboardLayout({ children }) {
  return (
    <Sidebar>
      {/* Server Componentã‚’å­ã¨ã—ã¦æ¸¡ã™ */}
      <NavigationMenu />
    </Sidebar>
  );
}
```

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°

### 3.1 Server Componentsã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ

**åŸå‰‡**: APIãƒ«ãƒ¼ãƒˆã‚’ä½œã‚‰ãšã€ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹

```typescript
// âœ… æ¨å¥¨: Server Componentã§ç›´æ¥DBã‚¢ã‚¯ã‚»ã‚¹
// lib/dal/projects.ts (Data Access Layer)
import { prisma } from "@/lib/db/prisma";
import { cache } from "react";
import { auth } from "@/lib/auth";

// React cacheã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆå˜ä½ã®ãƒ¡ãƒ¢åŒ–
export const getProjects = cache(async () => {
  const session = await auth();
  
  if (!session?.user?.id) {
    throw new Error("Unauthorized");
  }

  const projects = await prisma.project.findMany({
    where: {
      userId: session.user.id,
    },
    orderBy: {
      createdAt: "desc",
    },
  });

  return projects;
});

// å€‹åˆ¥å–å¾—ã‚‚ãƒ¡ãƒ¢åŒ–
export const getProject = cache(async (id: string) => {
  const session = await auth();
  
  if (!session?.user?.id) {
    throw new Error("Unauthorized");
  }

  const project = await prisma.project.findUnique({
    where: {
      id,
      userId: session.user.id,
    },
  });

  if (!project) {
    throw new Error("Project not found");
  }

  return project;
});
```

```typescript
// âœ… ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä½¿ç”¨
// app/projects/page.tsx
import { getProjects } from "@/lib/dal/projects";
import { Suspense } from "react";
import { ProjectList } from "@/components/features/dashboard/project-list";
import { ProjectListSkeleton } from "@/components/features/dashboard/project-list-skeleton";

export default function ProjectsPage() {
  return (
    <div>
      <h1>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</h1>
      <Suspense fallback={<ProjectListSkeleton />}>
        <ProjectListAsync />
      </Suspense>
    </div>
  );
}

async function ProjectListAsync() {
  const projects = await getProjects();
  return <ProjectList projects={projects} />;
}
```

### 3.2 ä¸¦åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ

```typescript
// âœ… Promise.allã§ä¸¦åˆ—ãƒ•ã‚§ãƒƒãƒ
// app/dashboard/page.tsx
import { getProjects } from "@/lib/dal/projects";
import { getUser } from "@/lib/dal/users";
import { getStats } from "@/lib/dal/stats";

export default async function DashboardPage() {
  // ä¸¦åˆ—ã§ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ
  const [projects, user, stats] = await Promise.all([
    getProjects(),
    getUser(),
    getStats(),
  ]);

  return (
    <div>
      <UserProfile user={user} />
      <StatsCards stats={stats} />
      <ProjectList projects={projects} />
    </div>
  );
}
```

### 3.3 Sequential vs Parallel ãƒ•ã‚§ãƒƒãƒ

```typescript
// âŒ é¿ã‘ã‚‹ã¹ã: ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«ãƒ•ã‚§ãƒƒãƒï¼ˆé…ã„ï¼‰
async function BadExample() {
  const user = await getUser();
  const projects = await getProjects(user.id); // userã®å¾Œã«å®Ÿè¡Œ
  const stats = await getStats(user.id);       // projectsã®å¾Œã«å®Ÿè¡Œ
  // åˆè¨ˆæ™‚é–“ = t1 + t2 + t3
}

// âœ… æ¨å¥¨: ä¸¦åˆ—ãƒ•ã‚§ãƒƒãƒï¼ˆé€Ÿã„ï¼‰
async function GoodExample() {
  const userPromise = getUser();
  const projectsPromise = getProjects();
  const statsPromise = getStats();
  
  const [user, projects, stats] = await Promise.all([
    userPromise,
    projectsPromise,
    statsPromise,
  ]);
  // åˆè¨ˆæ™‚é–“ = max(t1, t2, t3)
}

// âœ… ä¾å­˜é–¢ä¿‚ãŒã‚ã‚‹å ´åˆ
async function DependentExample() {
  const user = await getUser();
  
  // userãŒå–å¾—ã§ãã¦ã‹ã‚‰ä¸¦åˆ—ã§ä»–ã‚’å–å¾—
  const [projects, stats] = await Promise.all([
    getProjects(user.id),
    getStats(user.id),
  ]);
}
```

---

## 4. Server Actions

### 4.1 åŸºæœ¬çš„ãªå®Ÿè£…

```typescript
// âœ… Server Actionsã®å®Ÿè£…
// lib/actions/projects.ts
"use server";

import { revalidatePath } from "next/cache";
import { redirect } from "next/navigation";
import { z } from "zod";
import { prisma } from "@/lib/db/prisma";
import { auth } from "@/lib/auth";
import { projectSchema } from "@/lib/validations/project";

// å‹å®‰å…¨ãªServer Action
export async function createProject(formData: FormData) {
  // èªè¨¼ãƒã‚§ãƒƒã‚¯
  const session = await auth();
  if (!session?.user?.id) {
    throw new Error("Unauthorized");
  }

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const validatedFields = projectSchema.safeParse({
    name: formData.get("name"),
    description: formData.get("description"),
  });

  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
      message: "å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™",
    };
  }

  const { name, description } = validatedFields.data;

  try {
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
    const project = await prisma.project.create({
      data: {
        name,
        description,
        userId: session.user.id,
      },
    });

    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å†æ¤œè¨¼
    revalidatePath("/projects");
    revalidatePath("/dashboard");

    // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    redirect(`/projects/${project.id}`);
  } catch (error) {
    return {
      message: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ",
    };
  }
}

// å‰Šé™¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
export async function deleteProject(projectId: string) {
  const session = await auth();
  if (!session?.user?.id) {
    throw new Error("Unauthorized");
  }

  try {
    await prisma.project.delete({
      where: {
        id: projectId,
        userId: session.user.id, // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¿å‰Šé™¤å¯
      },
    });

    revalidatePath("/projects");
    return { success: true };
  } catch (error) {
    return { 
      success: false, 
      message: "å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ" 
    };
  }
}

// æ›´æ–°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
export async function updateProject(
  projectId: string,
  formData: FormData
) {
  const session = await auth();
  if (!session?.user?.id) {
    throw new Error("Unauthorized");
  }

  const validatedFields = projectSchema.safeParse({
    name: formData.get("name"),
    description: formData.get("description"),
  });

  if (!validatedFields.success) {
    return {
      errors: validatedFields.error.flatten().fieldErrors,
    };
  }

  try {
    await prisma.project.update({
      where: {
        id: projectId,
        userId: session.user.id,
      },
      data: validatedFields.data,
    });

    revalidatePath(`/projects/${projectId}`);
    revalidatePath("/projects");
    
    return { success: true };
  } catch (error) {
    return { 
      success: false, 
      message: "æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ" 
    };
  }
}
```

### 4.2 ãƒ•ã‚©ãƒ¼ãƒ ã§ã®Server Actionsä½¿ç”¨

```typescript
// âœ… Client Componentã§Server Actionsã‚’ä½¿ç”¨
// components/features/dashboard/create-project-form.tsx
"use client";

import { useFormState, useFormStatus } from "react-dom";
import { createProject } from "@/lib/actions/projects";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";

const initialState = {
  message: null,
  errors: {},
};

export function CreateProjectForm() {
  const [state, formAction] = useFormState(createProject, initialState);

  return (
    <form action={formAction} className="space-y-4">
      <div>
        <Label htmlFor="name">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</Label>
        <Input
          id="name"
          name="name"
          required
          aria-describedby="name-error"
        />
        {state.errors?.name && (
          <p id="name-error" className="text-sm text-red-500">
            {state.errors.name}
          </p>
        )}
      </div>

      <div>
        <Label htmlFor="description">èª¬æ˜</Label>
        <Textarea
          id="description"
          name="description"
          aria-describedby="description-error"
        />
        {state.errors?.description && (
          <p id="description-error" className="text-sm text-red-500">
            {state.errors.description}
          </p>
        )}
      </div>

      {state.message && (
        <p className="text-sm text-red-500">{state.message}</p>
      )}

      <SubmitButton />
    </form>
  );
}

function SubmitButton() {
  const { pending } = useFormStatus();

  return (
    <Button type="submit" disabled={pending}>
      {pending ? "ä½œæˆä¸­..." : "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ"}
    </Button>
  );
}
```

### 4.3 ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ã®Server Actionså‘¼ã³å‡ºã—

```typescript
// âœ… onClickç­‰ã§Server Actionsã‚’å‘¼ã³å‡ºã™
// components/features/dashboard/delete-project-button.tsx
"use client";

import { useState, useTransition } from "react";
import { deleteProject } from "@/lib/actions/projects";
import { Button } from "@/components/ui/button";
import { useToast } from "@/hooks/use-toast";
import { useRouter } from "next/navigation";

export function DeleteProjectButton({ projectId }: { projectId: string }) {
  const [isPending, startTransition] = useTransition();
  const { toast } = useToast();
  const router = useRouter();

  function handleDelete() {
    startTransition(async () => {
      const result = await deleteProject(projectId);
      
      if (result.success) {
        toast({
          title: "å‰Šé™¤ã—ã¾ã—ãŸ",
          description: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ",
        });
        router.push("/projects");
      } else {
        toast({
          title: "ã‚¨ãƒ©ãƒ¼",
          description: result.message,
          variant: "destructive",
        });
      }
    });
  }

  return (
    <Button
      variant="destructive"
      onClick={handleDelete}
      disabled={isPending}
    >
      {isPending ? "å‰Šé™¤ä¸­..." : "å‰Šé™¤"}
    </Button>
  );
}
```

---

## 5. API Routesï¼ˆæœ€å°é™ã®ä½¿ç”¨ï¼‰

### 5.1 API Routesä½¿ç”¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

**âŒ ä½œæˆã™ã¹ãã§ãªã„ã‚±ãƒ¼ã‚¹**:
- GETã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆServer Componentsã‚’ä½¿ç”¨ï¼‰
- å†…éƒ¨ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒç”¨APIï¼ˆDALã‚’ä½¿ç”¨ï¼‰
- CRUDã®ã»ã¨ã‚“ã©ï¼ˆServer Actionsã‚’ä½¿ç”¨ï¼‰

**âœ… ä½œæˆã™ã¹ãã‚±ãƒ¼ã‚¹**:
- Webhooksï¼ˆå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- å¤–éƒ¨APIã®Proxy
- ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£çµ±åˆ

### 5.2 Webhookå®Ÿè£…ä¾‹

```typescript
// âœ… Webhook APIã®å®Ÿè£…
// app/api/webhooks/stripe/route.ts
import { headers } from "next/headers";
import { NextResponse } from "next/server";
import Stripe from "stripe";
import { prisma } from "@/lib/db/prisma";

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {
  apiVersion: "2023-10-16",
});

const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET!;

export async function POST(req: Request) {
  const body = await req.text();
  const signature = headers().get("stripe-signature");

  if (!signature) {
    return NextResponse.json(
      { error: "No signature" },
      { status: 400 }
    );
  }

  let event: Stripe.Event;

  try {
    event = stripe.webhooks.constructEvent(
      body,
      signature,
      webhookSecret
    );
  } catch (error) {
    console.error("Webhook signature verification failed:", error);
    return NextResponse.json(
      { error: "Invalid signature" },
      { status: 400 }
    );
  }

  // ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
  try {
    switch (event.type) {
      case "checkout.session.completed":
        const session = event.data.object as Stripe.Checkout.Session;
        await handleCheckoutCompleted(session);
        break;

      case "customer.subscription.updated":
        const subscription = event.data.object as Stripe.Subscription;
        await handleSubscriptionUpdated(subscription);
        break;

      default:
        console.log(`Unhandled event type: ${event.type}`);
    }

    return NextResponse.json({ received: true });
  } catch (error) {
    console.error("Error processing webhook:", error);
    return NextResponse.json(
      { error: "Webhook handler failed" },
      { status: 500 }
    );
  }
}

async function handleCheckoutCompleted(
  session: Stripe.Checkout.Session
) {
  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°
  await prisma.subscription.create({
    data: {
      userId: session.metadata?.userId,
      stripeCustomerId: session.customer as string,
      stripeSubscriptionId: session.subscription as string,
      status: "active",
    },
  });
}

async function handleSubscriptionUpdated(
  subscription: Stripe.Subscription
) {
  await prisma.subscription.update({
    where: {
      stripeSubscriptionId: subscription.id,
    },
    data: {
      status: subscription.status,
      currentPeriodEnd: new Date(subscription.current_period_end * 1000),
    },
  });
}
```

### 5.3 ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰API

```typescript
// âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰APIã®å®Ÿè£…
// app/api/upload/route.ts
import { NextResponse } from "next/server";
import { put } from "@vercel/blob";
import { auth } from "@/lib/auth";

export async function POST(request: Request) {
  const session = await auth();
  
  if (!session?.user?.id) {
    return NextResponse.json(
      { error: "Unauthorized" },
      { status: 401 }
    );
  }

  try {
    const formData = await request.formData();
    const file = formData.get("file") as File;

    if (!file) {
      return NextResponse.json(
        { error: "No file provided" },
        { status: 400 }
      );
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ5MBï¼‰
    if (file.size > 5 * 1024 * 1024) {
      return NextResponse.json(
        { error: "File too large" },
        { status: 400 }
      );
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ãƒã‚§ãƒƒã‚¯
    const allowedTypes = ["image/jpeg", "image/png", "image/webp"];
    if (!allowedTypes.includes(file.type)) {
      return NextResponse.json(
        { error: "Invalid file type" },
        { status: 400 }
      );
    }

    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    const blob = await put(file.name, file, {
      access: "public",
      token: process.env.BLOB_READ_WRITE_TOKEN,
    });

    return NextResponse.json({ url: blob.url });
  } catch (error) {
    console.error("Upload error:", error);
    return NextResponse.json(
      { error: "Upload failed" },
      { status: 500 }
    );
  }
}
```

---

## 6. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

### 6.1 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç¨®é¡

| ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚¤ãƒ— | èª¬æ˜ | ä½¿ç”¨å ´æ‰€ |
|-----------------|------|---------|
| Request Memoization | ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…ã§ã®é‡è¤‡æ’é™¤ | Server Components |
| Data Cache | ã‚µãƒ¼ãƒãƒ¼é–“ã§æ°¸ç¶šåŒ– | fetch, cache() |
| Full Route Cache | é™çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çµæœ | ãƒ“ãƒ«ãƒ‰æ™‚ |
| Router Cache | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ | App Router |

### 6.2 ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š

```typescript
// âœ… fetchã§ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡
// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Šï¼ˆæ¨å¥¨ï¼‰
const data = await fetch("https://api.example.com/data");

// æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®å†æ¤œè¨¼ï¼ˆISRï¼‰
const data = await fetch("https://api.example.com/data", {
  next: { revalidate: 3600 }, // 1æ™‚é–“ã”ã¨ã«å†æ¤œè¨¼
});

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ï¼ˆå‹•çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰
const data = await fetch("https://api.example.com/data", {
  cache: "no-store", // æ¯å›æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
});

// ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ã®å†æ¤œè¨¼
const data = await fetch("https://api.example.com/data", {
  next: { tags: ["projects"] },
});
```

```typescript
// âœ… React cacheã§ã®é‡è¤‡æ’é™¤
// lib/dal/projects.ts
import { cache } from "react";
import { prisma } from "@/lib/db/prisma";

export const getProject = cache(async (id: string) => {
  // åŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…ã§è¤‡æ•°å›å‘¼ã°ã‚Œã¦ã‚‚1å›ã®ã¿å®Ÿè¡Œ
  return await prisma.project.findUnique({
    where: { id },
  });
});
```

### 6.3 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å†æ¤œè¨¼

```typescript
// âœ… Server Actionsã§ã®å†æ¤œè¨¼
// lib/actions/projects.ts
"use server";

import { revalidatePath, revalidateTag } from "next/cache";

export async function updateProject(id: string, data: ProjectData) {
  await prisma.project.update({
    where: { id },
    data,
  });

  // ãƒ‘ã‚¹ãƒ™ãƒ¼ã‚¹ã®å†æ¤œè¨¼
  revalidatePath("/projects");
  revalidatePath(`/projects/${id}`);
  revalidatePath("/dashboard");

  // ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ã®å†æ¤œè¨¼
  revalidateTag("projects");
}
```

### 6.4 Dynamic Renderingåˆ¶å¾¡

```typescript
// âœ… ãƒšãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«ã§ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
// app/projects/page.tsx

// é™çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
export const dynamic = "auto";

// å‹•çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ï¼‰
export const dynamic = "force-dynamic";

// é™çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¼·åˆ¶
export const dynamic = "force-static";

// ã‚¨ãƒ©ãƒ¼æ™‚ã®å‹•çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
export const dynamic = "error";

// å†æ¤œè¨¼é–“éš”ã®è¨­å®š
export const revalidate = 3600; // 1æ™‚é–“

// å†æ¤œè¨¼ãªã—ï¼ˆå®Œå…¨é™çš„ï¼‰
export const revalidate = false;
```

---

## 7. ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨SEO

### 7.1 é™çš„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

```typescript
// âœ… é™çš„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å®šç¾©
// app/page.tsx
import { Metadata } from "next";

export const metadata: Metadata = {
  title: "ãƒ›ãƒ¼ãƒ  | ãƒã‚¤ã‚¢ãƒ—ãƒª",
  description: "ãƒã‚¤ã‚¢ãƒ—ãƒªã®èª¬æ˜æ–‡",
  keywords: ["Next.js", "React", "TypeScript"],
  authors: [{ name: "é–‹ç™ºè€…å" }],
  openGraph: {
    title: "ãƒ›ãƒ¼ãƒ  | ãƒã‚¤ã‚¢ãƒ—ãƒª",
    description: "ãƒã‚¤ã‚¢ãƒ—ãƒªã®èª¬æ˜æ–‡",
    type: "website",
    locale: "ja_JP",
    url: "https://example.com",
    siteName: "ãƒã‚¤ã‚¢ãƒ—ãƒª",
    images: [
      {
        url: "https://example.com/og-image.jpg",
        width: 1200,
        height: 630,
        alt: "ãƒã‚¤ã‚¢ãƒ—ãƒªã®OGPç”»åƒ",
      },
    ],
  },
  twitter: {
    card: "summary_large_image",
    title: "ãƒ›ãƒ¼ãƒ  | ãƒã‚¤ã‚¢ãƒ—ãƒª",
    description: "ãƒã‚¤ã‚¢ãƒ—ãƒªã®èª¬æ˜æ–‡",
    images: ["https://example.com/twitter-image.jpg"],
    creator: "@twitter_handle",
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      "max-video-preview": -1,
      "max-image-preview": "large",
      "max-snippet": -1,
    },
  },
  viewport: {
    width: "device-width",
    initialScale: 1,
    maximumScale: 1,
  },
};

export default function HomePage() {
  return <div>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</div>;
}
```

### 7.2 å‹•çš„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

```typescript
// âœ… å‹•çš„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ
// app/projects/[id]/page.tsx
import { Metadata } from "next";
import { getProject } from "@/lib/dal/projects";
import { notFound } from "next/navigation";

type Props = {
  params: { id: string };
  searchParams: { [key: string]: string | string[] | undefined };
};

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const project = await getProject(params.id);

  if (!project) {
    return {
      title: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
    };
  }

  return {
    title: `${project.name} | ãƒã‚¤ã‚¢ãƒ—ãƒª`,
    description: project.description,
    openGraph: {
      title: project.name,
      description: project.description,
      images: project.imageUrl ? [project.imageUrl] : [],
    },
  };
}

export default async function ProjectPage({ params }: Props) {
  const project = await getProject(params.id);

  if (!project) {
    notFound();
  }

  return (
    <div>
      <h1>{project.name}</h1>
      <p>{project.description}</p>
    </div>
  );
}
```

### 7.3 JSON-LDæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿

```typescript
// âœ… æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®å®Ÿè£…
// app/projects/[id]/page.tsx
export default async function ProjectPage({ params }: Props) {
  const project = await getProject(params.id);

  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "Article",
    headline: project.name,
    description: project.description,
    image: project.imageUrl,
    datePublished: project.createdAt.toISOString(),
    dateModified: project.updatedAt.toISOString(),
    author: {
      "@type": "Person",
      name: project.author.name,
    },
  };

  return (
    <>
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
      />
      <article>
        <h1>{project.name}</h1>
        <p>{project.description}</p>
      </article>
    </>
  );
}
```

---

## 8. èªè¨¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 8.1 Middleware ã§ã®èªè¨¼

```typescript
// âœ… ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ã®èªè¨¼ãƒã‚§ãƒƒã‚¯
// middleware.ts
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";
import { getToken } from "next-auth/jwt";

export async function middleware(request: NextRequest) {
  const token = await getToken({
    req: request,
    secret: process.env.NEXTAUTH_SECRET,
  });

  const isAuthPage = request.nextUrl.pathname.startsWith("/login") ||
                     request.nextUrl.pathname.startsWith("/register");
  const isProtectedPage = request.nextUrl.pathname.startsWith("/dashboard") ||
                          request.nextUrl.pathname.startsWith("/projects");

  // èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèªè¨¼ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
  if (isAuthPage && token) {
    return NextResponse.redirect(new URL("/dashboard", request.url));
  }

  // æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¿è­·ã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
  if (isProtectedPage && !token) {
    const loginUrl = new URL("/login", request.url);
    loginUrl.searchParams.set("callbackUrl", request.nextUrl.pathname);
    return NextResponse.redirect(loginUrl);
  }

  return NextResponse.next();
}

export const config = {
  matcher: [
    /*
     * ä»¥ä¸‹ã‚’é™¤ãã™ã¹ã¦ã®ãƒ‘ã‚¹ã«ãƒãƒƒãƒ:
     * - api (APIãƒ«ãƒ¼ãƒˆ)
     * - _next/static (é™çš„ãƒ•ã‚¡ã‚¤ãƒ«)
     * - _next/image (ç”»åƒæœ€é©åŒ–)
     * - favicon.ico (ãƒ•ã‚¡ãƒ“ã‚³ãƒ³)
     */
    "/((?!api|_next/static|_next/image|favicon.ico).*)",
  ],
};
```

### 8.2 Rate Limiting

```typescript
// âœ… ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã®å®Ÿè£…
// lib/rate-limit.ts
import { LRUCache } from "lru-cache";

type Options = {
  uniqueTokenPerInterval?: number;
  interval?: number;
};

export function rateLimit(options?: Options) {
  const tokenCache = new LRUCache({
    max: options?.uniqueTokenPerInterval || 500,
    ttl: options?.interval || 60000,
  });

  return {
    check: (limit: number, token: string) =>
      new Promise<void>((resolve, reject) => {
        const tokenCount = (tokenCache.get(token) as number[]) || [0];
        if (tokenCount[0] === 0) {
          tokenCache.set(token, tokenCount);
        }
        tokenCount[0] += 1;

        const currentUsage = tokenCount[0];
        const isRateLimited = currentUsage >= limit;

        return isRateLimited ? reject() : resolve();
      }),
  };
}

// ä½¿ç”¨ä¾‹
// app/api/data/route.ts
import { rateLimit } from "@/lib/rate-limit";
import { NextResponse } from "next/server";

const limiter = rateLimit({
  interval: 60 * 1000, // 60ç§’
  uniqueTokenPerInterval: 500,
});

export async function POST(request: Request) {
  const ip = request.headers.get("x-forwarded-for") || "unknown";

  try {
    await limiter.check(10, ip); // 10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†
  } catch {
    return NextResponse.json(
      { error: "Rate limit exceeded" },
      { status: 429 }
    );
  }

  // å‡¦ç†ç¶šè¡Œ
  return NextResponse.json({ success: true });
}
```

### 8.3 CSRFä¿è­·

```typescript
// âœ… Server Actionsã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§CSRFä¿è­·ã‚ã‚Š
// è¿½åŠ ã®ä¿è­·ãŒå¿…è¦ãªå ´åˆ
// lib/csrf.ts
import { headers } from "next/headers";

export function validateCSRF() {
  const headersList = headers();
  const origin = headersList.get("origin");
  const host = headersList.get("host");

  if (!origin || !host) {
    throw new Error("Missing origin or host header");
  }

  const originUrl = new URL(origin);
  if (originUrl.host !== host) {
    throw new Error("CSRF validation failed");
  }
}

// Server Actionã§ä½¿ç”¨
"use server";

export async function sensitiveAction() {
  validateCSRF();
  // å‡¦ç†ç¶šè¡Œ
}
```

---

## 9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 9.1 Error Boundary

```typescript
// âœ… ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒªã®å®Ÿè£…
// app/error.tsx
"use client";

import { useEffect } from "react";
import { Button } from "@/components/ui/button";

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  useEffect(() => {
    // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’é€ä¿¡
    console.error(error);
  }, [error]);

  return (
    <div className="flex min-h-screen flex-col items-center justify-center">
      <h2 className="text-2xl font-bold">å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>
      <p className="mt-4 text-muted-foreground">
        {error.message || "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"}
      </p>
      <Button onClick={reset} className="mt-4">
        ã‚‚ã†ä¸€åº¦è©¦ã™
      </Button>
    </div>
  );
}
```

```typescript
// âœ… ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©
// app/global-error.tsx
"use client";

export default function GlobalError({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  return (
    <html>
      <body>
        <h2>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼</h2>
        <button onClick={reset}>ãƒªã‚»ãƒƒãƒˆ</button>
      </body>
    </html>
  );
}
```

### 9.2 Not Foundå‡¦ç†

```typescript
// âœ… ã‚«ã‚¹ã‚¿ãƒ 404ãƒšãƒ¼ã‚¸
// app/not-found.tsx
import Link from "next/link";
import { Button } from "@/components/ui/button";

export default function NotFound() {
  return (
    <div className="flex min-h-screen flex-col items-center justify-center">
      <h1 className="text-4xl font-bold">404</h1>
      <p className="mt-4 text-xl">ãƒšãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
      <Button asChild className="mt-6">
        <Link href="/">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</Link>
      </Button>
    </div>
  );
}
```

```typescript
// âœ… ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰notFoundã‚’å‘¼ã³å‡ºã™
// app/projects/[id]/page.tsx
import { notFound } from "next/navigation";
import { getProject } from "@/lib/dal/projects";

export default async function ProjectPage({ 
  params 
}: { 
  params: { id: string } 
}) {
  const project = await getProject(params.id);

  if (!project) {
    notFound(); // not-found.tsxã‚’è¡¨ç¤º
  }

  return <div>{project.name}</div>;
}
```

---

## 10. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 10.1 ç”»åƒæœ€é©åŒ–

```typescript
// âœ… next/imageã®æœ€é©ãªä½¿ç”¨
import Image from "next/image";

// é‡è¦ãªç”»åƒï¼ˆLCPå¯¾ç­–ï¼‰
<Image
  src="/hero.jpg"
  alt="ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒ"
  width={1200}
  height={600}
  priority // å„ªå…ˆçš„ã«èª­ã¿è¾¼ã¿
  placeholder="blur" // ã¼ã‹ã—ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
  blurDataURL="data:image/jpeg;base64,..." // ã‚«ã‚¹ã‚¿ãƒ ã¼ã‹ã—
/>

// é€šå¸¸ã®ç”»åƒ
<Image
  src="/product.jpg"
  alt="å•†å“ç”»åƒ"
  width={400}
  height={300}
  loading="lazy" // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: é…å»¶èª­ã¿è¾¼ã¿
  quality={90} // ç”»è³ªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 75ï¼‰
/>

// ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ç”»åƒ
<Image
  src="/banner.jpg"
  alt="ãƒãƒŠãƒ¼"
  fill
  style={{ objectFit: "cover" }}
  sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
/>

// å¤–éƒ¨ç”»åƒï¼ˆnext.config.mjsã§è¨­å®šå¿…è¦ï¼‰
<Image
  src="https://example.com/image.jpg"
  alt="å¤–éƒ¨ç”»åƒ"
  width={800}
  height={600}
  unoptimized={false} // æœ€é©åŒ–ã‚’æœ‰åŠ¹åŒ–
/>
```

### 10.2 ãƒ•ã‚©ãƒ³ãƒˆæœ€é©åŒ–

```typescript
// âœ… next/fontã®ä½¿ç”¨
// app/layout.tsx
import { Inter, Noto_Sans_JP } from "next/font/google";

const inter = Inter({
  subsets: ["latin"],
  display: "swap",
  variable: "--font-inter",
});

const notoSansJP = Noto_Sans_JP({
  subsets: ["latin"],
  display: "swap",
  weight: ["400", "700"],
  variable: "--font-noto-sans-jp",
});

export default function RootLayout({ children }) {
  return (
    <html lang="ja" className={`${inter.variable} ${notoSansJP.variable}`}>
      <body className="font-sans">{children}</body>
    </html>
  );
}

// âœ… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚©ãƒ³ãƒˆ
import localFont from "next/font/local";

const customFont = localFont({
  src: [
    {
      path: "../public/fonts/custom-regular.woff2",
      weight: "400",
      style: "normal",
    },
    {
      path: "../public/fonts/custom-bold.woff2",
      weight: "700",
      style: "normal",
    },
  ],
  variable: "--font-custom",
});
```

### 10.3 Suspenseã«ã‚ˆã‚‹æ®µéšçš„ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

```typescript
// âœ… Suspenseã§ã®éƒ¨åˆ†çš„ãªã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
// app/dashboard/page.tsx
import { Suspense } from "react";
import { StatsCards } from "@/components/features/dashboard/stats-cards";
import { RecentProjects } from "@/components/features/dashboard/recent-projects";
import { ActivityFeed } from "@/components/features/dashboard/activity-feed";
import { Skeleton } from "@/components/ui/skeleton";

export default function DashboardPage() {
  return (
    <div className="space-y-8">
      {/* å³åº§ã«è¡¨ç¤º */}
      <h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

      {/* å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç‹¬ç«‹ã—ã¦ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° */}
      <Suspense fallback={<StatsCardsSkeleton />}>
        <StatsCards />
      </Suspense>

      <div className="grid gap-8 md:grid-cols-2">
        <Suspense fallback={<RecentProjectsSkeleton />}>
          <RecentProjects />
        </Suspense>

        <Suspense fallback={<ActivityFeedSkeleton />}>
          <ActivityFeed />
        </Suspense>
      </div>
    </div>
  );
}

function StatsCardsSkeleton() {
  return (
    <div className="grid gap-4 md:grid-cols-4">
      {Array.from({ length: 4 }).map((_, i) => (
        <Skeleton key={i} className="h-32" />
      ))}
    </div>
  );
}
```

### 10.4 å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

```typescript
// âœ… å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå‰Šæ¸›
import dynamic from "next/dynamic";

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
const HeavyChart = dynamic(
  () => import("@/components/features/charts/heavy-chart"),
  {
    loading: () => <Skeleton className="h-64" />,
    ssr: false, // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ã¿
  }
);

// æ¡ä»¶ä»˜ãå‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
export function ChartViewer({ type }: { type: string }) {
  const Chart = dynamic(() => {
    switch (type) {
      case "bar":
        return import("@/components/charts/bar-chart");
      case "line":
        return import("@/components/charts/line-chart");
      case "pie":
        return import("@/components/charts/pie-chart");
      default:
        return import("@/components/charts/default-chart");
    }
  });

  return <Chart />;
}
```

---

## 11. ç’°å¢ƒå¤‰æ•°ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 11.1 ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

```bash
# âœ… .env.local (Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„)
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
DATABASE_URL="postgresql://..."

# èªè¨¼
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-secret-key"

# API Keysï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã¿ï¼‰
STRIPE_SECRET_KEY="sk_test_..."
OPENAI_API_KEY="sk-..."

# å…¬é–‹ç’°å¢ƒå¤‰æ•°ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ä½¿ç”¨å¯èƒ½ï¼‰
NEXT_PUBLIC_APP_URL="http://localhost:3000"
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY="pk_test_..."
```

```typescript
// âœ… ç’°å¢ƒå¤‰æ•°ã®å‹å®‰å…¨ãªä½¿ç”¨
// lib/env.ts
import { z } from "zod";

const envSchema = z.object({
  // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ç’°å¢ƒå¤‰æ•°
  DATABASE_URL: z.string().url(),
  NEXTAUTH_SECRET: z.string().min(1),
  STRIPE_SECRET_KEY: z.string().startsWith("sk_"),

  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ç’°å¢ƒå¤‰æ•°
  NEXT_PUBLIC_APP_URL: z.string().url(),
  NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: z.string().startsWith("pk_"),
});

export const env = envSchema.parse({
  DATABASE_URL: process.env.DATABASE_URL,
  NEXTAUTH_SECRET: process.env.NEXTAUTH_SECRET,
  STRIPE_SECRET_KEY: process.env.STRIPE_SECRET_KEY,
  NEXT_PUBLIC_APP_URL: process.env.NEXT_PUBLIC_APP_URL,
  NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,
});

// ä½¿ç”¨ä¾‹
import { env } from "@/lib/env";

const stripe = new Stripe(env.STRIPE_SECRET_KEY);
```

### 11.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼

```typescript
// âœ… next.config.mjsã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
/** @type {import('next').NextConfig} */
const nextConfig = {
  async headers() {
    return [
      {
        source: "/:path*",
        headers: [
          {
            key: "X-DNS-Prefetch-Control",
            value: "on",
          },
          {
            key: "Strict-Transport-Security",
            value: "max-age=63072000; includeSubDomains; preload",
          },
          {
            key: "X-Frame-Options",
            value: "SAMEORIGIN",
          },
          {
            key: "X-Content-Type-Options",
            value: "nosniff",
          },
          {
            key: "X-XSS-Protection",
            value: "1; mode=block",
          },
          {
            key: "Referrer-Policy",
            value: "origin-when-cross-origin",
          },
          {
            key: "Permissions-Policy",
            value: "camera=(), microphone=(), geolocation=()",
          },
        ],
      },
    ];
  },
};

export default nextConfig;
```

---

## 12. ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°

### 12.1 Server Componentsã®ãƒ†ã‚¹ãƒˆ

```typescript
// âœ… Server Componentsã®ãƒ†ã‚¹ãƒˆ
// __tests__/app/projects/page.test.tsx
import { render, screen } from "@testing-library/react";
import ProjectsPage from "@/app/projects/page";
import { getProjects } from "@/lib/dal/projects";

// ãƒ¢ãƒƒã‚¯
jest.mock("@/lib/dal/projects");

describe("ProjectsPage", () => {
  it("should render projects", async () => {
    const mockProjects = [
      { id: "1", name: "Project 1", description: "Description 1" },
      { id: "2", name: "Project 2", description: "Description 2" },
    ];

    (getProjects as jest.Mock).mockResolvedValue(mockProjects);

    // Server Componentã‚’ç›´æ¥ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    const page = await ProjectsPage();
    render(page);

    expect(screen.getByText("Project 1")).toBeInTheDocument();
    expect(screen.getByText("Project 2")).toBeInTheDocument();
  });
});
```

### 12.2 Server Actionsã®ãƒ†ã‚¹ãƒˆ

```typescript
// âœ… Server Actionsã®ãƒ†ã‚¹ãƒˆ
// __tests__/lib/actions/projects.test.ts
import { createProject } from "@/lib/actions/projects";
import { prisma } from "@/lib/db/prisma";
import { auth } from "@/lib/auth";

jest.mock("@/lib/db/prisma");
jest.mock("@/lib/auth");

describe("createProject", () => {
  it("should create a project", async () => {
    (auth as jest.Mock).mockResolvedValue({
      user: { id: "user-1" },
    });

    (prisma.project.create as jest.Mock).mockResolvedValue({
      id: "project-1",
      name: "Test Project",
      description: "Test Description",
      userId: "user-1",
    });

    const formData = new FormData();
    formData.append("name", "Test Project");
    formData.append("description", "Test Description");

    const result = await createProject(formData);

    expect(result).toHaveProperty("id", "project-1");
    expect(prisma.project.create).toHaveBeenCalledWith({
      data: {
        name: "Test Project",
        description: "Test Description",
        userId: "user-1",
      },
    });
  });
});
```

---

## 13. ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤

### 13.1 next.config.mjsè¨­å®š

```javascript
// âœ… æœ¬ç•ªç”¨ã®next.config.mjs
/** @type {import('next').NextConfig} */
const nextConfig = {
  // React Strict Mode
  reactStrictMode: true,

  // ç”»åƒæœ€é©åŒ–
  images: {
    domains: ["example.com", "cdn.example.com"],
    formats: ["image/avif", "image/webp"],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  },

  // å®Ÿé¨“çš„æ©Ÿèƒ½
  experimental: {
    // Partial Prerendering
    ppr: true,
    // Server Actions
    serverActions: {
      bodySizeLimit: "2mb",
      allowedOrigins: ["localhost:3000", "*.example.com"],
    },
  },

  // ãƒãƒ³ãƒ‰ãƒ«åˆ†æ
  webpack: (config, { isServer }) => {
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
      };
    }
    return config;
  },

  // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  async redirects() {
    return [
      {
        source: "/old-route",
        destination: "/new-route",
        permanent: true,
      },
    ];
  },

  // ãƒªãƒ©ã‚¤ãƒˆ
  async rewrites() {
    return [
      {
        source: "/api/v1/:path*",
        destination: "https://api.example.com/:path*",
      },
    ];
  },
};

export default nextConfig;
```

### 13.2 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### ãƒ“ãƒ«ãƒ‰å‰
- [ ] ç’°å¢ƒå¤‰æ•°ã®è¨­å®šç¢ºèª
- [ ] TypeScriptã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆ
- [ ] ESLintã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆ
- [ ] ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã¨æˆåŠŸç¢ºèª
- [ ] ä¾å­˜é–¢ä¿‚ã®æ›´æ–°ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- [ ] Lighthouse ã‚¹ã‚³ã‚¢ç¢ºèªï¼ˆ90+ç›®æ¨™ï¼‰
- [ ] Core Web Vitals ã®ç¢ºèª
  - LCP < 2.5ç§’
  - FID < 100ms
  - CLS < 0.1
- [ ] ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®ç¢ºèª
- [ ] ç”»åƒã®æœ€é©åŒ–ç¢ºèª

#### SEO
- [ ] ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®è¨­å®š
- [ ] sitemap.xml ã®ç”Ÿæˆ
- [ ] robots.txt ã®è¨­å®š
- [ ] æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®å®Ÿè£…
- [ ] OGPç”»åƒã®è¨­å®š

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- [ ] ç’°å¢ƒå¤‰æ•°ã®å®‰å…¨ãªç®¡ç†
- [ ] HTTPS ã®æœ‰åŠ¹åŒ–
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š
- [ ] CSP ã®è¨­å®š
- [ ] ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã®å®Ÿè£…

#### ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
- [ ] ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã®è¨­å®šï¼ˆSentryç­‰ï¼‰
- [ ] ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®è¨­å®š
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
- [ ] ãƒ­ã‚°åé›†ã®è¨­å®š

---

## 14. ã‚ˆãã‚ã‚‹è³ªå•

### Q1: Server Componentsã¨Client Componentsã‚’ã©ã†ä½¿ã„åˆ†ã‘ã‚‹ã¹ãã§ã™ã‹ï¼Ÿ
A: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯Server Componentsã§ã™ã€‚ä»¥ä¸‹ã®å ´åˆã®ã¿Client Componentsã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼š
- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆonClickç­‰ï¼‰ãŒå¿…è¦
- React Hooksï¼ˆuseState, useEffectç­‰ï¼‰ã‚’ä½¿ç”¨
- ãƒ–ãƒ©ã‚¦ã‚¶APIï¼ˆlocalStorageç­‰ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®çŠ¶æ…‹ç®¡ç†ãŒå¿…è¦

### Q2: API Routesã¯ã„ã¤ä½¿ã†ã¹ãã§ã™ã‹ï¼Ÿ
A: ä»¥ä¸‹ã®å ´åˆã®ã¿ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼š
- Webhooksï¼ˆå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- å¤–éƒ¨APIã®ãƒ—ãƒ­ã‚­ã‚·
ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã«ã¯Server Componentsã€ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯Server Actionsã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

### Q3: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ã©ã†ç®¡ç†ã™ã¹ãã§ã™ã‹ï¼Ÿ
A: 
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Šï¼ˆé™çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰
- é »ç¹ã«æ›´æ–°ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã¯`cache: 'no-store'`
- å®šæœŸçš„ã«æ›´æ–°ã™ã‚‹å ´åˆã¯`revalidate`ã‚’è¨­å®š
- Server Actionsã§ã¯`revalidatePath`/`revalidateTag`ã§å†æ¤œè¨¼

### Q4: ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ãŒé…ã„å ´åˆã¯ï¼Ÿ
A:
1. Suspenseã§æ®µéšçš„ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
2. ä¸¦åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒï¼ˆPromise.allï¼‰
3. ä¸è¦ãªClient Componentsã‚’å‰Šæ¸›
4. ç”»åƒã®æœ€é©åŒ–ï¼ˆnext/imageä½¿ç”¨ï¼‰
5. å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå‰Šæ¸›